(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const e=function(){function e(t,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._form=n,this._inputs=Array.from(this._form.querySelectorAll(t.inputSelector)),this._submitButton=this._form.querySelector(t.submitButtonSelector)}var n,o;return n=e,(o=[{key:"enableValidations",value:function(){var t=this;this._inputs.forEach((function(e){e.addEventListener("input",(function(){t._checkValidity(e),t._updateSubmitButtonState()}))}))}},{key:"clearValidations",value:function(){var t=this;this._inputs.forEach((function(e){return t._hideError(e)})),this._updateSubmitButtonState()}},{key:"_checkValidity",value:function(t){t.validity.valid?this._hideError(t):this._showError(t)}},{key:"_showError",value:function(t){var e=this._form.querySelector(".".concat(t.id,"-error"));t.classList.add(this._inputErrorClass),e.textContent=this._getValidationMessage(t),e.classList.add(this._errorClass)}},{key:"_hideError",value:function(t){var e=this._form.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._inputErrorClass),e.textContent="",e.classList.remove(this._errorClass)}},{key:"_getValidationMessage",value:function(t){return t.validity.valueMissing?"Вы пропустили это поле":t.validity.typeMismatch&&"url"===t.type?"Введите адрес сайта":t.validationMessage}},{key:"_hasErrors",value:function(){return this._inputs.some((function(t){return!t.validity.valid}))}},{key:"_updateSubmitButtonState",value:function(){this._hasErrors()?this.disableSubmitButton():this.enableSubmitButton()}},{key:"enableSubmitButton",value:function(){this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1}},{key:"disableSubmitButton",value:function(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0}}])&&t(n.prototype,o),e}();function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const o=function(){function t(e,n,o){var r=o.onClick,i=o.onDeleteClick,u=o.onLikeClick;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._imageLink=e.link,this._title=e.name,this.id=e.id,this._likesCount=e.likesCount,this.likeIsActive=e.likeIsActive,this._deleteEnabled=e.deleteEnabled,this._template=n,this._onClick=r,this._onDeleteClick=i,this._onLikeClick=u}var e,o;return e=t,(o=[{key:"build",value:function(){return this._card=this._getEmptyCard(),this._image=this._card.querySelector(".element__image"),this._setEventListeners(),this._image.style.backgroundImage="url('".concat(this._imageLink,"')"),this._card.querySelector(".element__header").textContent=this._title,this.setLikesCount(this._likesCount),this._deleteEnabled&&this._card.querySelector(".element__delete").classList.add("element__delete_active"),this._likeButton=this._card.querySelector(".like__button"),this.likeIsActive&&this._likeButton.classList.add("like__button_active"),this._card}},{key:"_getEmptyCard",value:function(){return this._template.content.querySelector(".element").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var t=this;this._card.querySelector(".element__like").addEventListener("click",(function(){return t._onLikeClick(t)})),this._image.addEventListener("click",(function(){return t._onClick(t._title,t._imageLink)})),this._deleteEnabled&&this._card.querySelector(".element__delete").addEventListener("click",(function(){return t._onDeleteClick(t)}))}},{key:"toggleLike",value:function(){this.likeIsActive=!this.likeIsActive,this._likeButton.classList.toggle("like__button_active")}},{key:"setLikesCount",value:function(t){this._likesCount=t,this._card.querySelector(".like__counter").textContent=this._likesCount}},{key:"remove",value:function(){this._card.remove(),this._card=null}}])&&n(e.prototype,o),t}();function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const i=function(){function t(e,n){var o=e.items,r=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._items=o,this._renderer=r,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"render",value:function(){var t=this;this._items.forEach((function(e){t.addItem(e)}))}},{key:"_addElement",value:function(t){this._container.prepend(t)}},{key:"addItem",value:function(t){this._addElement(this._renderer(t))}}])&&r(e.prototype,n),t}();var u={inputSelector:".form__input",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_visible",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled"},a=document.querySelector("#element-template"),s={nameFieldSelector:".profile__name",aboutFieldSelector:".profile__about",avatarSelector:".avatar__image"};function c(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._openPopupClass="popup_opened",this._popupLoadedClass="popup_loaded",this._popup=document.querySelector(e),this._onEscClose=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this._popup.classList.contains(this._popupLoadedClass)||this._popup.classList.add(this._popupLoadedClass),this._popup.classList.contains(this._openPopupClass)||(this._popup.classList.add(this._openPopupClass),this._enableClosePopupOnEsc())}},{key:"close",value:function(){this._popup.classList.contains(this._openPopupClass)&&(this._popup.classList.remove(this._openPopupClass),this._disableClosePopupOnEsc())}},{key:"setEventListeners",value:function(){var t=this;this._popup.querySelector(".popup__close-button").addEventListener("mousedown",(function(){return t.close()})),this._popup.querySelector(".popup__content").addEventListener("click",(function(t){return t.stopPropagation()})),this._popup.addEventListener("click",(function(){return t.close()}))}},{key:"_handleEscClose",value:function(t){"Escape"===t.key&&(t.preventDefault(),this.close())}},{key:"_enableClosePopupOnEsc",value:function(){document.addEventListener("keydown",this._onEscClose)}},{key:"_disableClosePopupOnEsc",value:function(){document.removeEventListener("keydown",this._onEscClose)}}])&&c(e.prototype,n),t}();function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function h(t,e,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=y(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(u,t);var e,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=y(o);if(r){var n=y(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return d(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=i.call(this,t))._previewImage=e._popup.querySelector(".preview__image"),e._previewTitle=e._popup.querySelector(".preview__title"),e.setEventListeners(),e}return e=u,(n=[{key:"open",value:function(t,e){this._previewTitle.textContent=t,this._previewImage.src=e,this._previewImage.alt=t,h(y(u.prototype),"open",this).call(this)}}])&&p(e.prototype,n),u}(l);function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function k(t,e,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=S(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const E=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(u,t);var e,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=S(o);if(r){var n=S(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return C(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._onFormSubmit=e,n._form=n._popup.querySelector(".form"),n.setEventListeners(),n._submitButton=n._popup.querySelector(".popup__save-button"),n._submitButtonInitialText=n._submitButton.textContent,n}return e=u,(n=[{key:"_getInputValues",value:function(){return Array.from(this._form.elements).filter((function(t){return t.name})).reduce((function(t,e){return t[e.name]=e.value,t}),{})}},{key:"_setInputValues",value:function(t){var e=this;Object.keys(t).forEach((function(n){e._form.elements[n].value=t[n]}))}},{key:"setEventListeners",value:function(){var t=this;k(S(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(e){e.preventDefault(),t._setSubmitButtonText("Сохранение..."),t._onFormSubmit(t._getInputValues())}))}},{key:"close",value:function(){k(S(u.prototype),"close",this).call(this),this._form.reset(),this._setSubmitButtonText(this._submitButtonInitialText)}},{key:"open",value:function(t){t&&this._setInputValues(t),k(S(u.prototype),"open",this).call(this)}},{key:"_setSubmitButtonText",value:function(t){this._submitButton.textContent=t}}])&&m(e.prototype,n),u}(l);function w(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const O=function(){function t(e,n){var o=n.nameFieldSelector,r=n.aboutFieldSelector,i=n.avatarSelector;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._nameField=document.querySelector(o),this._aboutField=document.querySelector(r),this._avatarImage=document.querySelector(i),this.id=e._id,this.setAvatar(e),this.setUserInfo(e)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{name:this._nameField.textContent,about:this._aboutField.textContent}}},{key:"setUserInfo",value:function(t){var e=t.name,n=t.about;this._nameField.textContent=e,this._aboutField.textContent=n}},{key:"getAvatar",value:function(){return{avatar:this._avatarImage.src}}},{key:"setAvatar",value:function(t){var e=t.avatar;this._avatarImage.src=e}}])&&w(e.prototype,n),t}();function L(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const P=function(){function t(e){var n=e.baseUri,o=e.authToken;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._baseUri=n,this._authToken=o}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return this._get("users/me")}},{key:"getInitialCards",value:function(){return this._get("cards")}},{key:"setUserInfo",value:function(t){var e=t.name,n=t.about;return this._patch("users/me",{name:e,about:n})}},{key:"setAvatar",value:function(t){var e=t.avatar;return this._patch("users/me/avatar",{avatar:e})}},{key:"createCard",value:function(t){var e=t.name,n=t.link;return this._post("cards",{name:e,link:n})}},{key:"deleteCard",value:function(t){return this._delete("cards/".concat(t))}},{key:"toggleLike",value:function(t,e){return e?this._delete("cards/likes/".concat(t)):this._put("cards/likes/".concat(t))}},{key:"_get",value:function(t){return this._getJson(fetch(this._buildUri(t),{headers:{authorization:this._authToken}}))}},{key:"_patch",value:function(t,e){return this._getJson(fetch(this._buildUri(t),{method:"PATCH",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify(e)}))}},{key:"_put",value:function(t){return this._getJson(fetch(this._buildUri(t),{method:"PUT",headers:{authorization:this._authToken}}))}},{key:"_post",value:function(t,e){return this._getJson(fetch(this._buildUri(t),{method:"POST",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify(e)}))}},{key:"_delete",value:function(t){return this._getJson(fetch(this._buildUri(t),{method:"DELETE",headers:{authorization:this._authToken}}))}},{key:"_buildUri",value:function(t){return"".concat(this._baseUri,"/").concat(t)}},{key:"_getJson",value:function(t){return t.then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}}])&&L(e.prototype,n),t}();function B(t){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function I(t,e,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=q(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function R(t,e){return!e||"object"!==B(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const A=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(u,t);var e,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=q(o);if(r){var n=q(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return R(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=i.call(this,t))._form=e._popup.querySelector(".form"),e.setEventListeners(),e}return e=u,(n=[{key:"setEventListeners",value:function(){var t=this;I(q(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(e){e.preventDefault(),t._onSubmit()}))}},{key:"open",value:function(t){this._onSubmit=t,I(q(u.prototype),"open",this).call(this)}},{key:"close",value:function(){this._onSubmit=null,I(q(u.prototype),"close",this).call(this)}}])&&j(e.prototype,n),u}(l);var x=new P({baseUri:"https://nomoreparties.co/v1/cohort-26",authToken:"e9c41e78-4da5-45a9-a519-987aa0bd1bef"}),U=new A(".popup_type_submit");function V(t){U.open((function(){x.deleteCard(t.id).then((function(){t.remove()})).then((function(t){return U.close()})).catch(J)}))}function D(t){x.toggleLike(t.id,t.likeIsActive).then((function(e){t.toggleLike(),t.setLikesCount(e.likes.length)})).catch(J)}function F(t,e){document.querySelector(t).addEventListener("click",e)}function J(t){console.log(t)}function z(t){return t.sort((function(t,e){return t.createdAt<e.createdAt?-1:t.createdAt>e.createdAt?1:0}))}function M(t,e){return{name:t.name,link:t.link,createdAt:Date.parse(t.createdAt),likesCount:t.likes.length,likeIsActive:t.likes.some((function(t){return t._id===e.id})),deleteEnabled:t.owner._id===e.id,id:t._id}}Promise.all([x.getUserInfo(),x.getInitialCards()]).then((function(t){var e=new O(t[0],s);return{cards:t[1].map((function(t){return M(t,e)})),me:e}})).then((function(t){var n=t.me,o=document.forms["profile-info"],r=new e(u,o),i=new E(".popup_type_profile-info",(function(t){r.disableSubmitButton(),x.setUserInfo(t).then((function(t){n.setUserInfo(t)})).then((function(t){return i.close()})).catch(J).finally((function(){return r.enableSubmitButton()}))}));return F(".profile__edit-button",(function(){i.open(n.getUserInfo()),r.clearValidations()})),r.enableValidations(),t})).then((function(t){var n=t.me,o=document.forms.avatar,r=new e(u,o),i=new E(".popup_type_avatar",(function(t){r.disableSubmitButton(),x.setAvatar(t).then((function(t){n.setAvatar(t)})).then((function(t){return i.close()})).catch(J).finally((function(){return r.enableSubmitButton()}))}));return F(".avatar__edit-button",(function(){i.open(n.getAvatar()),r.clearValidations()})),r.enableValidations(),t})).then((function(t){var n=t.cards,r=t.me,s=document.forms["add-element"],c=new e(u,s),l=new v(".popup_type_element-preview"),f=new E(".popup_type_element-info",(function(t){c.disableSubmitButton(),x.createCard(t).then((function(t){p.addItem(M(t,r))})).then((function(t){return f.close()})).catch(J).finally((function(){return c.enableSubmitButton()}))})),p=new i({items:z(n),renderer:function(t){return new o(t,a,{onClick:function(t,e){return l.open(t,e)},onDeleteClick:V,onLikeClick:D}).build()}},".elements");F(".profile__add-button",(function(){c.clearValidations(),f.open()})),c.enableValidations(),p.render()})).catch(J)})();